{"meta":{"title":"Xue's Homepage","subtitle":null,"description":"A Computer Science student in Dalian University of Technology","author":"Shiqing Xue","url":"http://yoursite.com"},"pages":[{"title":"404 Not Found：该页无法显示","date":"2018-09-15T09:17:06.689Z","updated":"2018-05-13T15:33:24.412Z","comments":false,"path":"/404.html","permalink":"http://yoursite.com//404.html","excerpt":"","text":""},{"title":"关于","date":"2018-09-15T09:33:40.833Z","updated":"2018-09-15T09:33:40.777Z","comments":false,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":"北京航空航天大学计算机学院研究生在读方向：云计算ACT实验室新主楼G5004sqxue@foxmail.com"},{"title":"书单","date":"2018-09-15T09:17:06.689Z","updated":"2018-05-13T15:33:24.412Z","comments":false,"path":"books/index.html","permalink":"http://yoursite.com/books/index.html","excerpt":"","text":""},{"title":"分类","date":"2018-09-15T09:17:06.689Z","updated":"2018-05-13T15:33:24.412Z","comments":false,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""},{"title":"友情链接","date":"2018-09-15T09:17:06.689Z","updated":"2018-05-13T15:33:24.412Z","comments":true,"path":"links/index.html","permalink":"http://yoursite.com/links/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2018-09-15T09:17:06.693Z","updated":"2018-05-13T15:33:24.412Z","comments":false,"path":"repository/index.html","permalink":"http://yoursite.com/repository/index.html","excerpt":"","text":""},{"title":"标签","date":"2018-09-15T09:17:06.693Z","updated":"2018-05-13T15:33:24.412Z","comments":false,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"OpenStack单节点安装","slug":"1_OpenStack单节点安装","date":"2018-06-02T05:25:44.115Z","updated":"2018-06-02T05:25:44.115Z","comments":true,"path":"2018/06/02/1_OpenStack单节点安装/","link":"","permalink":"http://yoursite.com/2018/06/02/1_OpenStack单节点安装/","excerpt":"","text":"OpenStack单节点单网卡安装参考陈沙克日志http://www.chenshake.com/ubuntu-12-04-openstack-essex-installation-single-node/ 作者：薛世卿如遇安装问题，可以咨询我。 注意，本文档不包含陈沙克的可选安装部分，这部分内容包括 ntp服务器 ISCSI（供Nova-volume使用） Nova-volume 一、准备系统系统信息我安装的节点为 IVIC 云主机 IP为 10.210.0.94 开始安装只需确保系统安装ssh server即可，然后更新源 apt-get update &amp;&amp; apt-get -y dist-upgrade 设置网络编辑/etc/network/interfaces，IP地址和DNS根据实际情况调整。 auto lo iface lo inet loopback auto eth0 iface eth0 inet static address 10.210.0.94 netmask 255.255.0.0 gateway 10.210.0.1 dns-nameserver 202.112.128.51 auto eth0:0 iface eth0:0 inet manual up ifconfig eth0:0 up Bridge使用linux的bridge和iptables来实现OpenStack的网络配置 apt-get -y install bridge-utils 环境变量你可以根据你的实际情况修改admin的密码和mysql的密码。下面文档和数据库相关的密码都是相同，你只需要修改novarc就可以。 运行完下面的命令，你再对novarc进行修改。 cat &gt;/root/novarc &lt;&lt;EOF export OS_TENANT_NAME=admin export OS_USERNAME=admin export OS_PASSWORD=password export MYSQL_PASS=password export SERVICE_PASSWORD=password export FIXED_RANGE=10.0.0.0/24 export FLOATING_RANGE=$(/sbin/ifconfig eth0 | awk &apos;/inet addr/ {print $2}&apos; | cut -f2 -d &quot;:&quot; | awk -F &quot;.&quot; &apos;{print $1&quot;.&quot;$2&quot;.&quot;$3}&apos;).224/27 export OS_AUTH_URL=&quot;http://localhost:5000/v2.0/&quot; export SERVICE_ENDPOINT=&quot;http://localhost:35357/v2.0&quot; export SERVICE_TOKEN=$(openssl rand -hex 10) export MASTER=&quot;$(/sbin/ifconfig eth0 | awk &apos;/inet addr/ {print $2}&apos; | cut -f2 -d &quot;:&quot;)&quot; EOF 我的novarc内容，与原博客不同的是，出于某种原因我注释掉了两行，具体原因我也不是很清楚了2333。 ubuntu@mu:~$ sudo cat /root/novarc export OS_TENANT_NAME=admin export OS_USERNAME=admin export OS_PASSWORD=password export MYSQL_PASS=password export SERVICE_PASSWORD=password export FIXED_RANGE=10.0.0.0/24 export FLOATING_RANGE=10.210.0.94/27 export OS_AUTH_URL=&quot;http://localhost:5000/v2.0/&quot; #export SERVICE_ENDPOINT=&quot;http://localhost:35357/v2.0&quot; #export SERVICE_TOKEN=a23debc939158820de0f export MASTER=&quot;10.210.0.94&quot; 确认没有问题或者进行修改，运行 source novarc echo &quot;source novarc&quot;&gt;&gt;.bashrc MYSQL在Openstack组件里，Nova，Keystone, Glance, 都需要用到数据库。所以我们需要创建相关的数据库和用户。 应用数据库数据库用户密码mysqlrootpasswordnovanovapasswordglanceglancepasswordkeystonekeystonepassword&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 安装mysql自动安装 cat &lt;&lt;MYSQL_PRESEED | debconf-set-selections mysql-server-5.5 mysql-server/root_password password $MYSQL_PASS mysql-server-5.5 mysql-server/root_password_again password $MYSQL_PASS mysql-server-5.5 mysql-server/start_on_boot boolean true MYSQL_PRESEED Openstack都是Python写的，所以你需要python-mysqldb，安装过程，就不会提示你输入root密码 apt-get install -y mysql-server python-mysqldb 配置编辑/etc/mysql/my.cnf, 允许网络访问mysql #bind-address = 127.0.0.1 bind-address = 0.0.0.0 或者直接运行下面命令 sed -i &apos;s/127.0.0.1/0.0.0.0/g&apos; /etc/mysql/my.cnf 重启mysql服务 service mysql restart 创建相关数据库 mysql -uroot -p$MYSQL_PASS &lt;&lt;EOF CREATE DATABASE nova; GRANT ALL PRIVILEGES ON nova.* TO &apos;nova&apos;@&apos;%&apos; IDENTIFIED BY &apos;$MYSQL_PASS&apos;; CREATE DATABASE glance; GRANT ALL PRIVILEGES ON glance.* TO &apos;glance&apos;@&apos;%&apos; IDENTIFIED BY &apos;$MYSQL_PASS&apos;; CREATE DATABASE keystone; GRANT ALL PRIVILEGES ON keystone.* TO &apos;keystone&apos;@&apos;%&apos;IDENTIFIED BY &apos;$MYSQL_PASS&apos;; FLUSH PRIVILEGES; EOF KeystoneKeystone是Openstack的核心，所有的组件，都需要通过keystone进行认证和授权。 租户（tenant）用户密码&nbsp;adminadminpassword&nbsp;servicenovapassword&nbsp;&nbsp;glancepassword&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 安装apt-get install -y keystone python-keystone python-keystoneclient 配置编辑/etc/keystone/keystone.conf，需要修改，注意数据库的连接IP和token根据自己的情况进行填写 keystone的默认token是ADMIN，我这里修改成随机生成，查看novarc获得 默认是采用sqlite连接，我们需要改成mysql [DEFAULT] #bind_host = 0.0.0.0 public_port = 5000 admin_port = 35357 #admin_token = ADMIN admin_token = a23debc939158820de0f [database] #connection = sqlite:////var/lib/keystone/keystone.db connection = mysql://keystone:password@10.210.0.94/keystone重启服务 service keystone restart同步keystone数据库 keystone-manage db_sync keystone的数据库，需要导入数据和endpoint，你可以一步一步用命令行导入，可以参考keystone白皮书 http://www.canonical.com/about-canonical/resources/white-papers/configuring-keystone-openstack-essex 为了方便，你可以直接使用下面2个脚本来进行全部的设置。 keystone_data.sh导入用户信息 endpoints.sh设置endpoint Keystone Datawget http://www.chenshake.com/wp-content/uploads/2012/07/keystone_data.sh_.txt mv keystone_data.sh_.txt keystone_data.sh bash keystone_data.sh 没任何输出，就表示正确，可以通过下面命令检查 echo $? 显示0，就表示脚本正确运行，千万不要重复运行脚本。 Endpoint 导入wget http://www.chenshake.com/wp-content/uploads/2012/07/endpoints.sh_.txt mv endpoints.sh_.txt endpoints.sh bash endpoints.sh 需要注意的是，这个脚本是假设你的glance服务和swift都是安装相同的服务器，如果你的glance在不同的服务器，你需要调整一下endpoint，可以在数据库里调整。 测试可以使用curl命令来测试。 命令如下 curl -d &apos;{&quot;auth&quot;: {&quot;tenantName&quot;: &quot;admin&quot;, &quot;passwordCredentials&quot;:{&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;password&quot;}}}&apos; -H &quot;Content-type:application/json&quot; http://$MASTER:35357/v2.0/tokens | python -mjson.tool 你就可以获得一个24小时的token。（注意，上面的脚本没有创建demo用户，所以没法用demo账号去测试） &quot;token&quot;: { &quot;expires&quot;: &quot;2012-09-27T02:09:37Z&quot;, &quot;id&quot;: &quot;c719448800214e189da04772c2f75e23&quot;, &quot;tenant&quot;: { &quot;description&quot;: null, &quot;enabled&quot;: true, &quot;id&quot;: &quot;dc7ca2e51139457dada2d0f7a3719476&quot;, &quot;name&quot;: &quot;admin&quot; } 通过下面命令，可以检查keystone的设置是否正确。 root@node:~# keystone user-list +----------------------------------+---------+----------------------+--------+ | id | enabled | email | name | +----------------------------------+---------+----------------------+--------+ | 1189d15892d24e00827e707bd2b7ab07 | True | admin@chenshake.com | admin | | cca4a4ed1e8842db99239dc98fb1617f | True | glance@chenshake.com | glance | | daccc34eacc7493989cd13df93e7f6bc | True | swift@chenshake.com | swift | | ee57b02c535d44f48943de13831da232 | True | nova@chenshake.com | nova | +----------------------------------+---------+----------------------+--------+ root@node17:~# keystone endpoint-list +----------------------------------+-----------+-----------------------------------------------+-----------------------------------------------+------------------------------------------+ | id | region | publicurl | internalurl | adminurl | +----------------------------------+-----------+-----------------------------------------------+-----------------------------------------------+------------------------------------------+ | 0b04e1baac1a4c9fb07490e0911192cf | RegionOne | http://10.1.199.17:5000/v2.0 | http://10.1.199.17:5000/v2.0 | http://10.1.199.17:35357/v2.0 | | 0d3315627d52419fa08095f9def5d7e4 | RegionOne | http://10.1.199.17:8776/v1/%(tenant_id)s | http://10.1.199.17:8776/v1/%(tenant_id)s | http://10.1.199.17:8776/v1/%(tenant_id)s | | 1c92290cba9f4a278b42dbdf2802096c | RegionOne | http://10.1.199.17:9292/v1 | http://10.1.199.17:9292/v1 | http://10.1.199.17:9292/v1 | | 56fe83ce20f341d99fc576770c275586 | RegionOne | http://10.1.199.17:8774/v2/%(tenant_id)s | http://10.1.199.17:8774/v2/%(tenant_id)s | http://10.1.199.17:8774/v2/%(tenant_id)s | | 5fb51aae00684e56818869918f86b564 | RegionOne | http://10.1.199.17:8080/v1/AUTH_%(tenant_id)s | http://10.1.199.17:8080/v1/AUTH_%(tenant_id)s | http://10.1.199.17:8080/v1 | | aaac7663872d493b85d9e583329be9ed | RegionOne | http://10.1.199.17:8773/services/Cloud | http://10.1.199.17:8773/services/Cloud | http://10.1.199.17:8773/services/Admin | +----------------------------------+-----------+-----------------------------------------------+-----------------------------------------------+------------------------------------------+ 可以使用下面命令来查看结果 keystone tenant-list keystone user-list keystone role-list Glance安装apt-get install -y glance glance-api glance-client glance-common glance-registry python-glance 配置编辑 /etc/glance/glance-api-paste.ini ，修改文档最后3行 #admin_tenant_name = %SERVICE_TENANT_NAME% #admin_user = %SERVICE_USER% #admin_password = %SERVICE_PASSWORD% admin_tenant_name = service admin_user = glance admin_password = password 编辑 /etc/glance/glance-registry.conf 和 /etc/glance/glance-api.conf ，改成使用mysql验证，作如下修改，ip地址根据自己情况设置。 [database] #sql_connection = sqlite:////var/lib/glance/glance.sqlite sql_connection = mysql://glance:password@10.210.0.94/glance [keystone_authtoken] auth_host = 10.210.0.94 auth_port = 35357 auth_protocol = http admin_tenant_name = service admin_user = glance admin_password = password [paste_deploy] flavor=keystone 重启glance服务 service glance-api restart &amp;&amp; service glance-registry restart 同步glance数据库 # glance-manage version_control 0 # glance-manage db_sync /usr/lib/python2.7/dist-packages/glance/registry/db/migrate_repo/versions/003_add_disk_format.py:47: SADeprecationWarning: useexisting is deprecated. Use extend_existing. useexisting=True) 重启glance服务 service glance-api restart &amp;&amp; service glance-registry restart 测试glance index 没有输出，表示正常，因为目前还没有镜像。 下载镜像我们下载CirrOS的image作为测试使用，只有10M。如果是ubuntu官方的image，220M，并且ubuntu官方的image，都是需要使用密钥登陆。 CirrOS下载并上传image wget https://launchpad.net/cirros/trunk/0.3.0/+download/cirros-0.3.0-x86_64-disk.img glance add name=cirros-0.3.0-x86_64 is_public=true container_format=bare \\ disk_format=qcow2 &lt; /root/cirros-0.3.0-x86_64-disk.img Cirros，可以使用用户名和密码登陆，也可以使用密钥登陆 user:cirros \\password:cubswin:) Ubuntu官方image下载并上传image wget http://cloud-images.ubuntu.com/precise/current/precise-server-cloudimg-amd64-disk1.img glance add name=&quot;Ubuntu 12.04 cloudimg amd64&quot; is_public=true container_format=ovf \\ disk_format=qcow2 &lt; /root/precise-server-cloudimg-amd64-disk1.img user：ubuntu 只能使用密钥登陆。 查看image# glance index ID Name Disk Format Container Format Size ------------------------------------ ------------------------------ -------------------- -------------------- -------------- 5dcf84a0-b491-4710-8d7a-5531bce0dedc cirros-0.3.0-x86_64 qcow2 bare 9761280 f4f62d8a-3e5b-4136-8547-ce3cb79771aa Ubuntu 12.04 cloudimg amd64 qcow2 ovf 230817792 Nova安装apt-get install -y nova-api nova-cert nova-common nova-objectstore \\ nova-scheduler nova-volume nova-consoleauth novnc python-nova python-novaclient \\ nova-compute nova-compute-kvm nova-network 如果你希望控制节点，不打算跑计算服务，装完后，把nova compute的服务停掉也可以。 配置编辑 /etc/nova/nova.conf 文件， 下面是我的nova.conf 文件的配置。 为了简单，大家直接copy下面内容，运行就可以，注意修改ip。 如果你是在虚拟机里安装，你需要把libvirt_type=kvm 改成 ibvirt_type=qemu [DEFAULT] dhcpbridge_flagfile=/etc/nova/nova.conf dhcpbridge=/usr/bin/nova-dhcpbridge logdir=/var/log/nova state_path=/var/lib/nova lock_path=/var/lock/nova force_dhcp_release=True iscsi_helper=tgtadm libvirt_use_virtio_for_bridges=True connection_type=libvirt root_helper=sudo nova-rootwrap /etc/nova/rootwrap.conf verbose=True ec2_private_dns_show_ip=True api_paste_config=/etc/nova/api-paste.ini volumes_path=/var/lib/nova/volumes enabled_apis=ec2,osapi_compute,metadata rpc_backend = rabbit rabbit_host = 10.210.0.94 my_ip = 10.210.0.94 vncserver_listen = 10.210.0.94 vncserver_proxyclient_address = 10.210.0.94 auth_strategy = keystone [keystone_authtoken] auth_uri = http://10.210.0.94:5000 auth_host = 10.210.0.94 auth_port = 35357 auth_protocol = http admin_tenant_name = service admin_user = nova admin_password = password [database] connection = mysql://nova:password@10.210.0.94/nova 设置目录权限 chown -R nova:nova /etc/nova 重启所有服务 service rabbitmq-server restart service libvirt-bin restart service nova-scheduler restart service nova-network restart service nova-cert restart service nova-compute restart service nova-api restart service nova-objectstore restart service nova-volume restart 也可以使用下面脚本进行重启 #!/bin/bash for a in rabbitmq-server libvirt-bin nova-network nova-cert nova-compute \\ nova-api nova-objectstore nova-scheduler nova-volume \\ novnc nova-consoleauth; do service &quot;$a&quot; stop; done for a in rabbitmq-server libvirt-bin nova-network nova-cert nova-compute \\ nova-api nova-objectstore nova-scheduler nova-volume \\ novnc nova-consoleauth; do service &quot;$a&quot; start; done 运行脚本 bash restart.sh Stopping rabbitmq-server: rabbitmq-server. libvirt-bin stop/waiting nova-network stop/waiting nova-cert stop/waiting nova-compute stop/waiting nova-api stop/waiting nova-objectstore stop/waiting nova-scheduler stop/waiting nova-volume stop/waiting * Stopping OpenStack NoVNC proxy nova-novncproxy [ OK ] nova-consoleauth stop/waiting Starting rabbitmq-server: SUCCESS rabbitmq-server. libvirt-bin start/running, process 9683 nova-network start/running, process 9703 nova-cert start/running, process 9713 nova-compute start/running, process 9724 nova-api start/running, process 9734 nova-objectstore start/running, process 9744 nova-scheduler start/running, process 9759 nova-volume start/running, process 9775 * Starting OpenStack NoVNC proxy nova-novncproxy [ OK ] nova-consoleauth start/running, process 9839 同步数据库 nova-manage db sync 会有一堆的输出，不过应该是没问题的。nova数据库里已经有相应的表，就表示正确。 # nova-manage db sync 2012-07-19 18:43:34 WARNING nova.utils [-] /usr/lib/python2.7/dist-packages/sqlalchemy/pool.py:639: SADeprecationWarning: The &apos;listeners&apos; argument to Pool (and create_engine()) is deprecated. Use event.listen(). Pool.__init__(self, creator, **kw) 2012-07-19 18:43:34 WARNING nova.utils [-] /usr/lib/python2.7/dist-packages/sqlalchemy/pool.py:145: SADeprecationWarning: Pool.add_listener is deprecated. Use event.listen() self.add_listener(l) 2012-07-19 18:43:34 AUDIT nova.db.sqlalchemy.fix_dns_domains [-] Applying database fix for Essex dns_domains table. 创建fix IPFIX IP，就是分配给虚拟机的实际IP地址。这些数据都会写入数据库。$FIXED_RANGE 在novarc里设置。 nova-manage network create private --fixed_range_v4=$FIXED_RANGE \\ --num_networks=1 --bridge=br100 --bridge_interface=eth1 \\ --network_size=256 --multi_host=T 创建floating IP所谓Floating IP，是亚马逊EC2的定义。简单说，就是公网的IP。他其实是通过类似防火墙类似，做一个映射。实际上是通过iptables来实现映射. nova-manage floating create --ip_range=$FLOATING_RANGE 重启nova服务 bash restart.sh libvirt-bin stop/waiting nova-network stop/waiting nova-cert stop/waiting nova-compute stop/waiting nova-api stop/waiting nova-objectstore stop/waiting nova-scheduler stop/waiting nova-volume stop/waiting * Stopping OpenStack NoVNC proxy nova-novncproxy [ OK ] nova-consoleauth stop/waiting libvirt-bin start/running, process 23232 nova-network start/running, process 23252 nova-cert start/running, process 23262 nova-compute start/running, process 23273 nova-api start/running, process 23285 nova-objectstore start/running, process 23303 nova-scheduler start/running, process 23321 nova-volume start/running, process 23336 * Starting OpenStack NoVNC proxy nova-novncproxy [ OK ] nova-consoleauth start/running, process 23386 测试可以尝试用下面命令去检查nova的状况 nova-manage service list 若state均为:-） \\说明安装成功 命令行创建虚拟机的过程nova keypair-add oskey &gt; oskey.priv chmod 600 oskey.priv nova flavor-list nova image-list nova boot --flavor 2 --key_name oskey --image ea3ffba1-065e-483f-bfe2-c84184ee76be test1 nova secgroup-add-rule default tcp 22 22 0.0.0.0/0 nova secgroup-add-rule default icmp -1 -1 0.0.0.0/0 这个时候，你在服务器上可以直接ssh到虚拟机上，ubuntu的虚拟机，用户是ubuntu。虚拟机的Ip # nova list +--------------------------------------+-------+--------+------------------+ | ID | Name | Status | Networks | +--------------------------------------+-------+--------+------------------+ | 61e93d62-c926-46fa-8e0c-48073b7e58b0 | test1 | ACTIVE | private=10.0.0.2 | | 6976e539-32d9-48a6-9fb5-28a3cdb55f71 | test2 | ACTIVE | private=10.0.0.4 | +--------------------------------------+-------+--------+------------------+ 在服务器上直接ssh到虚拟机，如果你在远程，就需要分配floating IP。 ssh -i oskey.priv ubuntu@10.0.0.4 登陆虚拟机后，你可以查看一下路由 $ route Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface default 10.0.0.3 0.0.0.0 UG 100 0 0 eth0 10.0.0.0 * 255.255.255.0 U 0 0 0 eth0 显示网关是10.0.0.3，这个时候，你看一下 root@node:~# ifconfig br100 Link encap:Ethernet HWaddr 00:e0:81:d8:4a:23 inet addr:10.0.0.3 Bcast:10.0.0.255 Mask:255.255.255.0 inet6 addr: fe80::ccfc:5aff:fef5:4345/64 Scope:Link 需要注意的是：br100的IP，需要你创建第一个虚拟机，他才会获得IP。 Dashobard安装apt-get install -y apache2 libapache2-mod-wsgi openstack-dashboard 重启nova api restart nova-api 这个时候，就可以访问dashboard。 测试登陆dashobard，下面地址是我的horizon界面，可以直接访问，注：需要北航内网。 http://10.210.0.94/horizon \\user:admin \\pass:password","categories":[],"tags":[{"name":"OpenStack","slug":"OpenStack","permalink":"http://yoursite.com/tags/OpenStack/"}]},{"title":"你好，Hexo","slug":"你好，Hexo","date":"2018-05-13T14:23:13.000Z","updated":"2018-05-13T14:23:13.092Z","comments":true,"path":"2018/05/13/你好，Hexo/","link":"","permalink":"http://yoursite.com/2018/05/13/你好，Hexo/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2018-05-13T13:58:28.016Z","updated":"2018-05-13T13:58:28.016Z","comments":true,"path":"2018/05/13/hello-world/","link":"","permalink":"http://yoursite.com/2018/05/13/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}]}